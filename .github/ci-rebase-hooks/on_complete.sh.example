#!/usr/bin/env bash
#
# Example Completion Hook
# This hook runs after all rebase operations complete
#
# Arguments:
#   $1 = Success count
#   $2 = Conflict count
#   $3 = Failure count
#   $4 = Total duration (seconds)
#
# To use: cp on_complete.sh.example on_complete.sh && chmod +x on_complete.sh

set -euo pipefail

SUCCESS="$1"
CONFLICTS="$2"
FAILURES="$3"
DURATION="${4:-0}"

# Example: Generate summary report
REPORT_FILE="/tmp/ci-rebase-summary-$(date +%Y%m%d_%H%M%S).md"

cat > "$REPORT_FILE" <<EOF
# CI Rebase Automation Summary

**Date**: $(date -Iseconds)
**Duration**: ${DURATION}s

## Results

- âœ… **Successful**: $SUCCESS
- âš ï¸  **Conflicts**: $CONFLICTS
- âŒ **Failures**: $FAILURES

## Total PRs Processed

$((SUCCESS + CONFLICTS + FAILURES))

## Next Steps

$(if (( CONFLICTS > 0 || FAILURES > 0 )); then
  echo "- Review failed PRs and resolve conflicts manually"
  echo "- Check workflow logs for detailed error messages"
else
  echo "- All PRs rebased successfully!"
  echo "- Monitor CI checks on updated PRs"
fi)

---
*Generated by CI Rebase Automation*
EOF

echo "ðŸ“Š Summary report saved to: $REPORT_FILE"

# Example: Archive metrics
if [[ -f "/tmp/ci-rebase-metrics.json" ]]; then
  cp "/tmp/ci-rebase-metrics.json" "/tmp/ci-rebase-metrics-archive-$(date +%Y%m%d_%H%M%S).json"
fi

exit 0
