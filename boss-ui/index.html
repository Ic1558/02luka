<!doctype html><meta charset="utf-8" />
<title>Boss Workspace UI</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<div id="app" style="display:flex;height:100vh;font-family:system-ui">
  <aside style="width:220px;background:#f4f4f5;padding:12px">
    <h3>Folders</h3>
    <div id="folders"></div>
  </aside>
  <main style="flex:1;display:flex;flex-direction:column">
    <div id="status" style="padding:12px;border-bottom:1px solid #ddd;font-weight:600"></div>
    <div style="display:flex;flex:1;min-height:0">
      <ul id="messages" style="width:280px;border-right:1px solid #ddd;overflow:auto;list-style:none;padding:0;margin:0"></ul>
      <pre id="viewer" style="flex:1;overflow:auto;margin:0;padding:16px;white-space:pre-wrap;color:#111"></pre>
    </div>
  </main>
</div>
<script>
  const API_BASE = 'http://127.0.0.1:4000';

  async function loadMailbox(mailbox) {
    const status = document.getElementById('status');
    const list = document.getElementById('messages');
    status.textContent = 'Loading…';
    list.innerHTML = '';
    try {
      const resp = await fetch(`${API_BASE}/api/list/${mailbox}`);
      if (!resp.ok) throw new Error(`API error: ${resp.status}`);
      const payload = await resp.json();
      status.textContent = `${payload.items.length} items in ${payload.mailbox}`;
      payload.items.forEach((item) => {
        const li = document.createElement('li');
        li.innerHTML = `<strong>${item.name}</strong>
                        <div class="meta">${item.updatedAt} · ${item.size} bytes</div>`;
        li.style.cursor = 'pointer';
        li.onclick = async () => {
          try {
            const r = await fetch(`${API_BASE}/api/file/${mailbox}/${encodeURIComponent(item.name)}`);
            const t = await r.text();
            alert(t.length > 1000 ? t.slice(0, 1000) + '…' : t); // viewer ง่าย ๆ ชั่วคราว
          } catch (e) {
            alert('Failed to open file');
          }
        };
        list.appendChild(li);
      });
    } catch (error) {
      console.error('Failed to load mailbox', error);
      status.textContent = 'Failed to load mailbox.';
      status.classList.add('error');
    }
  }
  loadMailbox('inbox');
</script>
