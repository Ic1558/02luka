{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Bridge Self-Check Report",
  "description": "Validation report for bridge inbox/outbox/processed folder integrity and permissions",
  "type": "object",
  "required": ["timestamp", "status", "agents", "summary"],
  "properties": {
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when the check was performed"
    },
    "status": {
      "type": "string",
      "enum": ["healthy", "warning", "critical"],
      "description": "Overall health status of the bridge system"
    },
    "agents": {
      "type": "array",
      "description": "Per-agent bridge status",
      "items": {
        "type": "object",
        "required": ["agent_id", "status", "folders"],
        "properties": {
          "agent_id": {
            "type": "string",
            "description": "Agent identifier (e.g., CLC, KIM, ANDY)"
          },
          "status": {
            "type": "string",
            "enum": ["healthy", "warning", "critical"],
            "description": "Agent-specific health status"
          },
          "folders": {
            "type": "object",
            "description": "Status of inbox/outbox/processed folders",
            "properties": {
              "inbox": {
                "$ref": "#/definitions/folderStatus"
              },
              "outbox": {
                "$ref": "#/definitions/folderStatus"
              },
              "processed": {
                "$ref": "#/definitions/folderStatus"
              }
            }
          },
          "issues": {
            "type": "array",
            "description": "List of detected issues",
            "items": {
              "type": "object",
              "required": ["severity", "message"],
              "properties": {
                "severity": {
                  "type": "string",
                  "enum": ["info", "warning", "critical"]
                },
                "type": {
                  "type": "string",
                  "enum": ["permission", "stuck_file", "missing_folder", "integrity", "other"]
                },
                "message": {
                  "type": "string"
                },
                "path": {
                  "type": "string",
                  "description": "Affected file or directory path"
                },
                "details": {
                  "type": "object",
                  "description": "Additional context about the issue"
                }
              }
            }
          },
          "metrics": {
            "type": "object",
            "description": "Agent-specific metrics",
            "properties": {
              "pending_work_orders": {
                "type": "integer",
                "description": "Number of work orders in inbox"
              },
              "stuck_files": {
                "type": "integer",
                "description": "Files older than threshold"
              },
              "processed_count": {
                "type": "integer",
                "description": "Number of items in processed folder"
              }
            }
          }
        }
      }
    },
    "summary": {
      "type": "object",
      "required": ["total_agents", "healthy_count", "warning_count", "critical_count"],
      "properties": {
        "total_agents": {
          "type": "integer",
          "description": "Total number of agents checked"
        },
        "healthy_count": {
          "type": "integer",
          "description": "Number of healthy agents"
        },
        "warning_count": {
          "type": "integer",
          "description": "Number of agents with warnings"
        },
        "critical_count": {
          "type": "integer",
          "description": "Number of agents with critical issues"
        },
        "total_issues": {
          "type": "integer",
          "description": "Total number of issues detected"
        }
      }
    }
  },
  "definitions": {
    "folderStatus": {
      "type": "object",
      "required": ["exists", "permissions"],
      "properties": {
        "exists": {
          "type": "boolean",
          "description": "Whether the folder exists"
        },
        "permissions": {
          "type": "string",
          "pattern": "^([drwx-]{10}|n/a)$",
          "description": "Unix-style permission string (e.g., drwxr-xr-x) or 'n/a' if folder doesn't exist"
        },
        "file_count": {
          "type": "integer",
          "description": "Number of files/folders in directory"
        },
        "oldest_file_age_hours": {
          "type": "number",
          "description": "Age of oldest file in hours"
        }
      }
    }
  }
}
