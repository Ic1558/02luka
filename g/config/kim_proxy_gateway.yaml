# Kim Proxy Gateway Configuration
# Phase 15 - Autonomous Knowledge Routing (AKR)
# WO-ID: WO-251107-PHASE-15-KIM-PROXY

service:
  name: kim_proxy_gateway
  version: 1.0.0
  description: "Intelligent query routing through Kim agent"
  port: 8767
  host: 127.0.0.1

routing:
  default_agent: kim
  fallback_agent: vector_search

  confidence_thresholds:
    high: 0.85  # Route directly
    medium: 0.70  # Route with logging
    low: 0.50  # Ask for clarification

  # Ambiguous query handling
  ambiguous_threshold: 0.50
  on_ambiguous: ask_clarification

  # Multi-agent queries
  multi_agent_enabled: false
  multi_agent_threshold: 0.90

backends:
  vector_search:
    url: http://127.0.0.1:8766/vector_query
    enabled: true
    timeout_ms: 5000
    retry_count: 2

  rag_legacy:
    url: http://127.0.0.1:8765/rag_query
    enabled: true
    timeout_ms: 5000
    retry_count: 1

  mcp_memory:
    url: http://localhost:5330
    enabled: false
    timeout_ms: 3000

  mcp_search:
    url: http://localhost:5340
    enabled: false
    timeout_ms: 3000

  andy:
    type: agent
    delegation_enabled: true

  system:
    type: cli
    allowed_commands:
      - backup
      - restart
      - deploy
      - status

intent_classification:
  model: pattern_based
  confidence_threshold: 0.70

  features:
    keyword_matching: true
    pattern_matching: true
    context_analysis: false  # Future enhancement
    rag_lookup: false  # Future enhancement

  patterns:
    code_task:
      confidence: 0.90
      keywords:
        - write code
        - implement
        - create function
        - add feature
        - fix bug
        - refactor
        - debug
        - test
        - commit
        - push

    system_command:
      confidence: 0.85
      keywords:
        - backup
        - restart
        - deploy
        - status
        - health
        - sync

    knowledge_query:
      confidence: 0.80
      keywords:
        - what
        - who
        - when
        - where
        - why
        - how
        - explain
        - describe
        - search
        - find
        - translate
        - summary

delegation:
  enabled: true
  max_hops: 3
  timeout_ms: 5000

  handoff_protocol:
    include_context: true
    include_history: true
    max_context_tokens: 3000

  prevent_circular: true

telemetry:
  enabled: true
  schema: config/telemetry_unified.yaml
  sink: ~/02luka/g/telemetry_unified/unified.jsonl

  events:
    - kim.intent.classified
    - kim.query.completed
    - kim.query.error
    - kim.classify.requested
    - kim.delegation.initiated
    - kim.delegation.completed
    - service.started
    - service.stopped

performance:
  max_concurrent_queries: 20
  query_timeout_ms: 10000
  max_query_length: 1000

  rate_limits:
    requests_per_minute: 120
    burst_size: 30

cache:
  enabled: true
  ttl_seconds: 300
  max_entries: 1000

health_check:
  endpoint: /health
  interval_seconds: 30
  timeout_ms: 3000

  dependencies:
    - vector_search
    - rag_legacy

logging:
  level: info
  format: json
  destination: stdout

metadata:
  phase: "15"
  work_order: "WO-251107-PHASE-15-KIM-PROXY"
  created: "2025-11-06"
  author: "claude"
