@@ -102,7 +102,15 @@
             )
 
             # Check if response was blocked
-            if not response.candidates or not response.candidates[0].content.parts:
+            if not response.candidates: # Check if candidates list is empty
+                logger.error(f"Response blocked: No candidates found.")
+                if response.prompt_feedback and response.prompt_feedback.block_reason:
+                    logger.error(f"Block reason: {response.prompt_feedback.block_reason}")
+                return None
+
+            if not response.candidates[0].content.parts: # Check if parts list is empty
                 logger.error(f"Response blocked. Finish reason: {response.candidates[0].finish_reason if response.candidates else unknown}")
                 return None
 
+            # Remove markdown code block wrappers if present
+            cleaned_text = response.text.strip()
