<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>02luka · Work Order Timeline</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="htmx.min.js" defer></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
      body {
        font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }
    </style>
  </head>
  <body class="bg-slate-950 text-slate-100 min-h-screen">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-8">
      <header class="space-y-4">
        <p class="inline-flex items-center text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">Dashboard · v2.2 Timeline</p>
        <div class="flex flex-wrap items-center gap-4">
          <h1 class="text-3xl font-semibold text-white tracking-tight">Work Order Timeline / History</h1>
          <span class="inline-flex items-center gap-2 rounded-full border border-emerald-400/40 px-3 py-1 text-sm text-emerald-300">
            <span class="h-2 w-2 rounded-full bg-emerald-400 animate-pulse"></span>
            Live data
          </span>
        </div>
        <p class="text-slate-400 max-w-3xl text-base">
          A chronological view of every work order executed by CLC agents. Built for debugging, analytics, and MLS correlation. All data is collected
          from the existing state + telemetry files – no orchestrator changes required.
        </p>
        <div class="flex flex-wrap items-center gap-3 text-sm text-slate-400">
          <a href="index.html" class="inline-flex items-center gap-2 rounded-full border border-slate-700 px-4 py-1.5 text-slate-200 transition hover:border-slate-500 hover:text-white">
            <span aria-hidden="true">←</span>
            Back to dashboard
          </a>
          <button type="button" data-action="refresh-timeline" class="inline-flex items-center gap-2 rounded-full border border-slate-700 px-4 py-1.5 text-slate-200 transition hover:border-slate-500 hover:text-white">
            <span class="h-2 w-2 rounded-full bg-blue-400"></span>
            Refresh now
          </button>
        </div>
      </header>

      <section class="bg-slate-900/60 rounded-3xl border border-slate-800 shadow-2xl shadow-black/40">
        <div class="border-b border-slate-800 px-6 py-5 flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
          <div>
            <h2 class="text-xl font-semibold">History feed</h2>
            <p class="text-sm text-slate-400">Filter by status/agent to focus on the signals that matter.</p>
          </div>
          <form id="timeline-filters" class="grid gap-3 sm:grid-cols-2 lg:grid-cols-4 w-full lg:w-auto">
            <label class="text-sm font-medium text-slate-300">
              Status
              <select id="filter-status" class="mt-1 w-full rounded-xl border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-200 focus:border-blue-400 focus:outline-none">
                <option value="">All statuses</option>
                <option value="queued">Queued</option>
                <option value="running">Running</option>
                <option value="success">Success</option>
                <option value="failed">Failed</option>
                <option value="dropped">Dropped</option>
                <option value="timeout">Timeout</option>
              </select>
            </label>
            <label class="text-sm font-medium text-slate-300">
              Agent
              <input id="filter-agent" type="text" placeholder="Any" class="mt-1 w-full rounded-xl border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-200 focus:border-blue-400 focus:outline-none" />
            </label>
            <label class="text-sm font-medium text-slate-300">
              Type
              <input id="filter-type" type="text" placeholder="Any" class="mt-1 w-full rounded-xl border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-200 focus:border-blue-400 focus:outline-none" />
            </label>
            <label class="text-sm font-medium text-slate-300">
              Log tail
              <select id="filter-tail" class="mt-1 w-full rounded-xl border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-200 focus:border-blue-400 focus:outline-none">
                <option value="25">25 lines</option>
                <option value="50" selected>50 lines</option>
                <option value="100">100 lines</option>
                <option value="200">200 lines</option>
              </select>
            </label>
          </form>
        </div>
        <div class="p-6 space-y-4">
          <div id="timeline-error" class="hidden rounded-2xl border border-rose-500/60 bg-rose-500/10 px-4 py-3 text-sm text-rose-100"></div>
          <div id="timeline-loading" class="flex items-center gap-3 rounded-2xl border border-slate-800 bg-slate-950/40 px-4 py-3 text-sm text-slate-300">
            <span class="h-2.5 w-2.5 rounded-full bg-blue-400 animate-pulse"></span>
            Loading timeline…
          </div>
          <div id="timeline-root" class="space-y-6" role="feed" aria-live="polite"></div>
          <div
            id="history-loader"
            hx-get="/api/wos/history?limit=200"
            hx-trigger="load, timelineRefresh from:body"
            hx-target="this"
            hx-swap="none"
            class="hidden"
          ></div>
        </div>
      </section>
    </div>

    <script type="module" src="timeline.js"></script>
  </body>
</html>
