# Codex Routing Log (JSONL format)
# Purpose: Track Codex usage, measure CLC quota savings, validate quality
# Format: One JSON object per line (easy to parse, append-only)
# Usage: Append each task routed to Codex
#
# Schema:
# {
#   "timestamp": "ISO 8601 datetime",
#   "task_id": "unique task identifier",
#   "task_type": "code_review | refactor | test_gen | debug | analysis | other",
#   "zone": "locked | non-locked",
#   "engine": "codex | clc | gemini",
#   "command": "exact command used",
#   "duration_sec": number,
#   "success": boolean,
#   "quality_score": 1-10,
#   "prompts_triggered": number,
#   "clc_quota_saved": boolean,
#   "notes": "optional notes"
# }
#
# Example entries:
{"timestamp":"2025-12-30T02:50:00Z","task_id":"test-001","task_type":"code_review","zone":"non-locked","engine":"codex","command":"codex-system 'review tools/session_save.zsh'","duration_sec":203,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":true,"notes":"First production test - excellent findings"}
{"timestamp":"2025-12-30T03:10:00Z","task_id":"issue-001-git-add-fix","task_type":"security_fix","zone":"non-locked","engine":"clc","command":"fix git add -A in tools/session_save.zsh","duration_sec":600,"success":true,"quality_score":10,"prompts_triggered":0,"clc_quota_saved":false,"notes":"Issue #1 High severity - Fixed by CLC (Codex TTY limitation). Replaced git add -A with explicit file list. Commit: d298b70e"}
{"timestamp":"2025-12-29T20:27:36Z","task_id":"task-20251230-032736","task_type":"reliability_improvement","zone":"non-locked","engine":"codex","command":"codex-task add jq check","duration_sec":0,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":true,"notes":""}
{"timestamp":"2025-12-29T20:47:00Z","task_id":"issue-002-json-escaping-fix","task_type":"security_fix","zone":"non-locked","engine":"clc","command":"fix JSON escaping in tools/session_save.zsh","duration_sec":900,"success":true,"quality_score":10,"prompts_triggered":0,"clc_quota_saved":false,"notes":"Issue #2 Medium severity - Fixed by CLC (Codex TTY limitation). Replaced printf with jq -nc for safe JSON. Commit: 13c42703"}
{"timestamp":"2025-12-29T20:50:00Z","task_id":"issue-004-mls-capture-validation","task_type":"testing","zone":"non-locked","engine":"clc","command":"validate mls_capture.zsh error handling","duration_sec":2400,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":false,"notes":"Issue #4 Medium severity - Applied by Codex earlier, validated by CLC manual testing. 9/9 improvements tested, 100% pass rate. Critical test: corrupted index recovery working."}
{"timestamp":"2025-12-30T21:00:00Z","task_id":"week1-task-1.1-mls-search","task_type":"reliability_improvement","zone":"non-locked","engine":"codex","command":"codex-task create mls_search.zsh with jq check","duration_sec":201,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":true,"notes":"Week 1 Task 1.1 - Created NEW tools/mls_search.zsh (better than modifying). jq check, keyword/type filters, working. Sanity checks passed."}
{"timestamp":"2025-12-30T21:03:00Z","task_id":"week1-task-3.2-codex-quickref","task_type":"documentation","zone":"non-locked","engine":"codex","command":"codex-task create codex quick reference","duration_sec":201,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":true,"notes":"Week 1 Task 3.2 - Created g/manuals/codex_quick_reference.md. 5 sections, 29 lines, concise and actionable. Production-ready."}
{"timestamp":"2025-12-30T21:10:00Z","task_id":"week1-task-1.3-metrics-validation","task_type":"reliability_improvement","zone":"non-locked","engine":"codex","command":"codex-task add JSON validation to metrics summary","duration_sec":95,"success":true,"quality_score":9,"prompts_triggered":1,"clc_quota_saved":true,"notes":"Week 1 Task 1.3 - Added JSON validation with temp file. Had counting bug (jq -r vs -c), self-corrected. Final output correct: 7/7 (100%), ~57% savings. 22 warnings expected (header comments)."}
{"timestamp":"2025-12-30T21:20:00Z","task_id":"week1-task-1.5-mary-errors","task_type":"reliability_improvement","zone":"non-locked","engine":"codex","command":"codex-task improve error messages in mary_preflight","duration_sec":129,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":true,"notes":"Week 1 Task 1.5 - Added error() function with Error/Impact/Fix pattern. Applied to 5 conditions. Boss ran successfully."}
{"timestamp":"2025-12-30T21:22:00Z","task_id":"week1-task-2.3-log-paths","task_type":"refactor","zone":"non-locked","engine":"codex","command":"codex-task improve path handling in log_codex_task","duration_sec":129,"success":true,"quality_score":10,"prompts_triggered":0,"clc_quota_saved":true,"notes":"Week 1 Task 2.3 - Added SCRIPT_DIR/REPO_ROOT detection. LOG_FILE now repo-relative. mkdir -p added. Perfect implementation."}
{"timestamp":"2025-12-30T21:24:00Z","task_id":"week1-task-2.4-checkpoint-refactor","task_type":"refactor","zone":"non-locked","engine":"codex","command":"codex-task refactor git checkpoint functions","duration_sec":129,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":true,"notes":"Week 1 Task 2.4 - Extracted create_checkpoint() and rollback_checkpoint(). Reduced duplication. Better variable naming."}
{"timestamp":"2025-12-30T21:26:00Z","task_id":"week1-task-3.1-findings-summary","task_type":"documentation","zone":"non-locked","engine":"codex","command":"codex-task add Phase Complete summary to findings","duration_sec":120,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":true,"notes":"Week 1 Task 3.1 - Added Phase Complete Summary to CODEX_FINDINGS_ACTION_PLAN.md. 4/4 issues resolved, commits listed, key insights, next steps. Production-ready."}
{"timestamp":"2025-12-30T21:28:00Z","task_id":"week1-task-2.1-session-save-refactor","task_type":"refactor","zone":"non-locked","engine":"codex","command":"codex-task extract parse_mls_data function","duration_sec":120,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":true,"notes":"Week 1 Task 2.1 - Extracted parse_mls_data() from session_save.zsh. Improved testability and organization. Clean refactor."}
{"timestamp":"2025-12-30T21:30:00Z","task_id":"week1-task-3.3-codex-setup-guide","task_type":"documentation","zone":"non-locked","engine":"codex","command":"codex-task create Tier 2 setup guide","duration_sec":120,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":true,"notes":"Week 1 Task 3.3 - Created tools/CODEX_SETUP.md. Comprehensive Tier 2 config with copy-paste toml, shell aliases, validation steps. 60+ lines, production-ready."}
{"timestamp":"2025-12-30T21:32:00Z","task_id":"week1-task-3.5-routing-flowchart","task_type":"documentation","zone":"non-locked","engine":"codex","command":"codex-task create routing flowchart","duration_sec":120,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":true,"notes":"Week 1 Task 3.5 - Created g/docs/CODEX_ROUTING_FLOWCHART.md. Text-based decision tree for CLC vs Codex routing. Clear, actionable, includes TTY limitation."}
{"timestamp":"2025-12-31T04:15:00Z","task_id":"week2-task-1.1-solution-collector-errors","task_type":"reliability_improvement","zone":"non-locked","engine":"codex","command":"codex-task add error handling to solution_collector.zsh","duration_sec":180,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":true,"notes":"Week 2 Task 1.1 - Added die/warn helpers, repo check, python3 check, mkdir failure handling, ledger/telemetry permission checks. Comprehensive error handling, production-ready."}
{"timestamp":"2025-12-31T04:20:00Z","task_id":"week2-task-1.2-save-atomic-write","task_type":"reliability_improvement","zone":"non-locked","engine":"codex","command":"codex-task add atomic write to save.sh","duration_sec":180,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":true,"notes":"Week 2 Task 1.2 - Added atomic_write_file() helper to tools/save.sh. Uses mktemp + validate + mv pattern for corruption prevention. Applied to save metadata with graceful failure handling."}
{"timestamp":"2025-12-31T04:25:00Z","task_id":"week2-task-1.5-metrics-quiet-warnings","task_type":"reliability_improvement","zone":"non-locked","engine":"codex","command":"codex-task reduce noisy warnings in codex_metrics_summary.zsh","duration_sec":120,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":true,"notes":"Week 2 Task 1.5 - Updated tools/codex_metrics_summary.zsh to skip blank and comment lines without warnings. Eliminates 22 header line warnings, only reports truly invalid JSON."}
{"timestamp":"2025-12-31T04:30:00Z","task_id":"week2-task-2.1-tty-guard","task_type":"reliability_improvement","zone":"non-locked","engine":"codex","command":"codex-task add TTY guard to codex-task wrapper","duration_sec":120,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":true,"notes":"Week 2 Task 2.1 - Added TTY detection to codex-task() in tools/setup_codex_workspace.zsh. Exits early with clear message when run non-interactively (e.g., CI)."}
{"timestamp":"2025-12-31T04:32:00Z","task_id":"week2-task-2.2-flowchart-link","task_type":"documentation","zone":"non-locked","engine":"codex","command":"codex-task link flowchart in routing spec","duration_sec":60,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":true,"notes":"Week 2 Task 2.2 - Added flowchart reference to g/docs/CODEX_CLC_ROUTING_SPEC.md under Routing Decision Flow section. Simple docs update."}
{"timestamp":"2025-12-31T04:35:00Z","task_id":"week2-task-1.4-telemetry-comments","task_type":"documentation","zone":"non-locked","engine":"codex","command":"codex-task update telemetry comments in session_save.zsh","duration_sec":90,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":true,"notes":"Week 2 Task 1.4 - Updated comments in tools/session_save.zsh telemetry section. Now explicitly mentions jq -nc, auto-escaping, and --argjson type preservation. Aligned with Issue #2 fix."}
{"timestamp":"2025-12-31T04:38:00Z","task_id":"week2-task-3.1-week1-report","task_type":"documentation","zone":"non-locked","engine":"codex","command":"codex-task create Week 1 routing report","duration_sec":180,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":true,"notes":"Week 2 Task 3.1 - Created WEEK1_ROUTING_REPORT.md. Comprehensive retrospective: 12 tasks, metrics, issues (TTY, jq bug), lessons learned, Week 2 recommendations. Production-ready."}
{"timestamp":"2025-12-31T04:40:00Z","task_id":"week2-task-3.2-sandbox-strategy-update","task_type":"documentation","zone":"non-locked","engine":"codex","command":"codex-task update sandbox strategy with Week 1 results","duration_sec":120,"success":true,"quality_score":9,"prompts_triggered":0,"clc_quota_saved":true,"notes":"Week 2 Task 3.2 - Updated CODEX_SANDBOX_STRATEGY.md with Week 1 Results section (12 tasks, 9.2/10, 80% savings) and Week 2 Targets (flowchart-aligned). Production-ready."}
