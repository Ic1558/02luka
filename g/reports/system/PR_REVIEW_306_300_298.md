# PR Review: #306, #300, #298

**Date:** 2025-11-16  
**Reviewer:** Liam  
**Status:** Summary Report

---

## PR #306: Include filters in trading snapshot filenames

**State:** OPEN  
**Branch:** `codex/fix-trading-cli-snapshot-naming-issue`  
**Base:** `main`  
**Changes:** +85 / -8 lines in 2 files

### Summary
- Add helper utilities to slugify filter values and build suffixes for trading snapshots
- Include applicable filter suffixes when generating snapshot filenames so different filter combinations do not overwrite each other

### Files Changed
1. `g/manuals/trading_snapshot_manual.md` (+7 / -5)
2. `tools/trading_snapshot.zsh` (+78 / -3)

### Testing
- `bash -n tools/trading_snapshot.zsh`

### Assessment
✅ **Small, focused change**  
✅ **Fixes filename collision issue**  
✅ **Well-documented**  
✅ **Ready for review/merge**

---

## PR #300: Add unified trading CLI with prompts and MLS hooks

**State:** OPEN  
**Branch:** `codex/refactor-trading-tools-into-unified-cli`  
**Base:** `main`  
**Changes:** +147,439 / -759 lines (⚠️ **HUGE**)

### Summary
- Introduce Python-based backend (invoked via `tools/trading_cli.zsh`) that unifies:
  - Trading imports
  - Snapshots
  - ChatGPT prompt generation
  - MLS emission
- Support scenario/tag metadata, Markdown + JSON snapshot exports, ChatGPT friendly summaries, and optional MLS lesson entries

### Key Features
- Unified CLI: `tools/trading_cli.zsh`
- Scenario/tag metadata support
- Markdown + JSON snapshot exports
- ChatGPT-friendly summaries
- Optional MLS lesson entries

### Testing
```bash
tools/trading_cli.zsh import /tmp/sample_trades.csv --market TFEX --account BIZ-01 --scenario intraday-hedge --tag range-bound
tools/trading_cli.zsh snapshot --day 2025-11-15 --market TFEX --account BIZ-01 --scenario intraday-hedge --tag range-bound --tag system-test
tools/trading_cli.zsh chatgpt-prompt --day 2025-11-15 --market TFEX --account BIZ-01 --scenario intraday-hedge --tag range-bound
```

### Assessment
⚠️ **Very large PR** (147K+ additions)  
⚠️ **Many files changed** (100+ files)  
⚠️ **Includes many backup files** (`.bak`, `.bak~` files)  
⚠️ **Needs careful review** - consider splitting into smaller PRs

### Concerns
- Large number of backup files included (should be cleaned up)
- Many LaunchAgent plist files in disabled directories
- Bridge inbox/archive files included
- MCP health reports included

**Recommendation:** Review file list carefully, remove backup files and temporary data files before merge.

---

## PR #298: feat(trading): add trading journal CSV importer and MLS hook

**State:** OPEN  
**Branch:** `codex/add-trading-journal-csv-importer`  
**Base:** `main`  
**Changes:** +18,035 / -60 lines

### Summary
- Add `tools/trading_import.zsh` for importing broker CSV statements into normalized JSONL ledger
- Optional MLS lesson stub emission for TTA/MLS analysis
- Define `g/schemas/trading_journal.schema.json` plus CSV template example
- Document ingestion flow in `g/manuals/trading_import_manual.md`

### Fixes
✅ **Timestamp Parsing Fix (Resolves Code Review P1)**
- `parse_timestamp()` now returns `None` for invalid/unrecognized formats (strict rejection)
- Rows with invalid timestamps are skipped with detailed logging
- Schema validation enforces ISO-8601 `date-time` format
- Prevents downstream consumers from receiving non-normalized timestamps

**Before:** Unrecognized formats like `15-11-2025 09:15` were passed through as raw text  
**After:** Invalid formats return `None`, row is skipped with error log

### Files Changed
- `tools/trading_import.zsh` (new)
- `g/schemas/trading_journal.schema.json` (new)
- `g/manuals/trading_import_manual.md` (new)
- `g/templates/trading_journal_example.csv` (new)
- Many AP/IO v3.1 integration files
- Agent README files
- Documentation files
- LaunchAgent plists
- Bridge archive files
- MCP health reports

### Testing
```bash
tools/trading_import.zsh g/trading/import/statement_example.csv --market TFEX --account BIZ-01 --emit-mls
```

### Status
- ✅ Merge conflicts resolved
- ✅ WIP commits squashed
- ✅ Timestamp fix verified
- ✅ Ready for review/merge

### Assessment
⚠️ **Large PR** (18K+ additions)  
⚠️ **Includes many unrelated files** (AP/IO v3.1, agent docs, bridge archives, MCP health reports)  
✅ **Core feature is well-implemented**  
✅ **Timestamp fix addresses code review concern**

### Concerns
- Many files unrelated to trading import (AP/IO v3.1, agent docs, bridge archives)
- MCP health reports included (should be excluded)
- Bridge archive files included (should be excluded)

**Recommendation:** Consider splitting into:
1. Core trading import feature (PR #298)
2. AP/IO v3.1 integration (separate PR)
3. Agent documentation updates (separate PR)
4. Remove bridge archives and MCP health reports

---

## Summary & Recommendations

### PR #306 ✅
**Status:** Ready to merge  
**Action:** Approve and merge

### PR #300 ⚠️
**Status:** Needs cleanup  
**Action:**
1. Remove backup files (`.bak`, `.bak~`)
2. Remove bridge archive files
3. Remove MCP health reports
4. Consider splitting into smaller PRs
5. Review file list carefully

### PR #298 ⚠️
**Status:** Needs cleanup  
**Action:**
1. Remove unrelated files (AP/IO v3.1, agent docs, bridge archives, MCP health reports)
2. Focus on core trading import feature
3. Split AP/IO v3.1 integration into separate PR
4. Review file list carefully

---

## Common Issues Across PRs

1. **Backup files included** - Should be removed
2. **Bridge archive files** - Should be excluded from PRs
3. **MCP health reports** - Should be excluded from PRs
4. **Large file counts** - Consider splitting large PRs

---

**Next Steps:**
1. Review PR #306 for merge
2. Request cleanup for PR #300 and #298
3. Consider PR splitting strategy for large changes

