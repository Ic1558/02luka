# PR #355 Fix Plan

**Date:** 2025-11-18  
**PR:** [#355 - LaunchAgent Validator](https://github.com/Ic1558/02luka/pull/355)  
**Status:** BLOCKING — Conflicts + Path Guard violations

---

## Executive Summary

**Verdict:** ⚠️ **BLOCKING** — Requires conflict resolution and Path Guard fixes

**Issues:**
1. **Merge Conflicts:** 3 files
2. **Path Guard Violations:** 152 files in wrong location
3. **Large PR:** 217 files (mostly reports)

**Estimated Time:** 1-2 hours

---

## Issue 1: Merge Conflicts (3 files)

### Files with Conflicts

1. **`apps/dashboard/dashboard.js`** (content conflict)
   - Main has dashboard v2.2.0 features
   - PR #355 has older version
   - **Resolution:** Accept main version, merge PR additions

2. **`apps/dashboard/index.html`** (content conflict)
   - Similar to dashboard.js
   - **Resolution:** Accept main version, merge PR additions

3. **`tools/validate_launchagents.zsh`** (add/add conflict)
   - Both branches added this file
   - **Resolution:** Merge both versions, keep unique content

### Resolution Strategy

**Priority 1: Dashboard Files**
```bash
# Accept main version as base
git checkout --theirs apps/dashboard/dashboard.js
git checkout --theirs apps/dashboard/index.html

# Then manually merge PR-specific additions (if any)
```

**Priority 2: Validator Script**
```bash
# Merge both versions
git checkout --ours tools/validate_launchagents.zsh
# Then manually merge unique content from main
```

---

## Issue 2: Path Guard Violations (152 files)

### Problem

**Violation:** Files in `g/reports/` root instead of subdirectories

**Path Guard Rule:**
- Reports must be in `g/reports/system/` or other subdirectories
- Not allowed in `g/reports/` root

**Current State:**
- 152 files in `g/reports/` root (e.g., `g/reports/report_name.md`)
- Should be in `g/reports/system/` or appropriate subdirectory

### Fix Strategy

**Option 1: Move All to `g/reports/system/`** (Recommended)
```bash
# Move all report files to system subdirectory
find g/reports/ -maxdepth 1 -type f -name "*.md" -exec mv {} g/reports/system/ \;
```

**Option 2: Organize by Type**
- LaunchAgent reports → `g/reports/system/launchagents/`
- Other reports → `g/reports/system/`

### Implementation Steps

1. **Identify all violating files:**
   ```bash
   gh pr diff 355 --name-only | grep "^g/reports/[^/]*$"
   ```

2. **Create target directory:**
   ```bash
   mkdir -p g/reports/system/launchagents
   ```

3. **Move files:**
   ```bash
   # Move launchagent-related reports
   git mv g/reports/launchagent_*.md g/reports/system/launchagents/ 2>/dev/null || true
   
   # Move other reports
   git mv g/reports/*.md g/reports/system/ 2>/dev/null || true
   ```

4. **Commit fix:**
   ```bash
   git commit -m "fix(path-guard): move report files to g/reports/system/ subdirectories"
   ```

---

## Issue 3: Large PR (217 files)

### Analysis

**Files Breakdown:**
- Report files: ~152 files (Path Guard violations)
- Core feature: ~5 files (validator, LaunchAgent)
- Other: ~60 files

**Impact:**
- Review difficult
- CI may be slow
- Merge conflicts more likely

### Recommendation

**Option 1: Split PR** (If possible)
- PR #355a: Core validator feature
- PR #355b: Report files (after Path Guard fix)

**Option 2: Fix in Current PR**
- Fix Path Guard violations
- Resolve conflicts
- Keep as single PR

---

## Implementation Plan

### Phase 1: Resolve Conflicts (30 min)

1. Checkout PR branch
2. Merge main
3. Resolve 3 conflicts:
   - Accept main for dashboard files
   - Merge validator script
4. Test dashboard functionality
5. Commit resolution

### Phase 2: Fix Path Guard (30-60 min)

1. Identify all violating files
2. Create target directories
3. Move files to correct locations
4. Update any references (if needed)
5. Commit fix

### Phase 3: Verification (15 min)

1. Run Path Guard check
2. Verify no conflicts
3. Test validator script
4. Re-run CI checks

### Phase 4: Final Steps (15 min)

1. Push fixes to PR branch
2. Verify CI passes
3. Update PR description
4. Ready for merge

---

## Commands Reference

### Check Conflicts
```bash
git checkout <pr-branch>
git merge origin/main --no-commit --no-ff
git status --short | grep "^UU\|^AA"
```

### Fix Path Guard
```bash
# Find violating files
gh pr diff 355 --name-only | grep "^g/reports/[^/]*$"

# Move files
mkdir -p g/reports/system/launchagents
git mv g/reports/launchagent_*.md g/reports/system/launchagents/
git mv g/reports/*.md g/reports/system/
```

### Verify
```bash
# Check Path Guard
gh pr checks 355 | grep -i "path"

# Check conflicts
gh pr view 355 --json mergeable,mergeStateStatus
```

---

## Success Criteria

✅ All merge conflicts resolved  
✅ All Path Guard violations fixed  
✅ Dashboard functionality preserved  
✅ Validator script works  
✅ CI checks pass  
✅ PR ready for merge

---

## Risk Assessment

**High Risk:**
- Dashboard conflicts (core application files)
- Large number of files to move

**Medium Risk:**
- Path Guard fix (many files, but straightforward)

**Low Risk:**
- Validator script conflict (add/add, easy to merge)

---

## Next Steps

1. ⏳ Resolve merge conflicts
2. ⏳ Fix Path Guard violations
3. ⏳ Test and verify
4. ⏳ Push fixes
5. ⏳ Re-run CI

---

## References

- PR #355: https://github.com/Ic1558/02luka/pull/355
- Code Review: `g/reports/system/pr355_code_review_20251118.md`
- Path Guard Rules: `.github/workflows/path-guard.yml`
