# System Catalog v1 — Single Source of Truth for Tools & Commands
# Updated: 2025-12-10
# Purpose: Prevent agents from using outdated tool/alias information
#
# Usage: zsh tools/catalog_lookup.zsh <command>

version: 1
updated: "2025-12-10"
maintainer: "Boss / Docs Agent"

# =============================================================================
# COMMANDS — Primary entry points
# =============================================================================
commands:
  save-now:
    description: "Lightweight session save from MLS ledger"
    entry: "./tools/save.sh"
    usage: "cd ~/02luka && AGENT_ID=<agent_name> SAVE_SOURCE=terminal ./tools/save.sh"
    env: "AGENT_ID=<agent_name> SAVE_SOURCE=terminal"
    function: "dev_save"
    source: "git_safety_aliases.zsh"
    notes: "Command should be interpreted as: cd ~/02luka && AGENT_ID=<agent_name> SAVE_SOURCE=terminal ./tools/save.sh. Uses save.sh as gateway, NOT session_save.zsh directly"
    
  seal-now:
    description: "Full chain: Review → GitDrop → Save"
    entry: "./tools/workflow_dev_review_save.zsh"
    fallback: "./tools/workflow_dev_review_save.py"
    env: "GG_AGENT_ID=<agent_name>"
    function: "dev_seal"
    source: "git_safety_aliases.zsh"
    
  seal-status:
    description: "Show recent seal/review chain runs"
    entry: "./tools/workflow_dev_review_save_status.zsh"
    function: "dev_review_save_status"
    
  spawn:
    description: "LAPP Plugin Spawner v2.1"
    entry: "./tools/spawn.zsh"
    usage: "zsh spawn.zsh <plugin_name> \"<input>\" [--dry-run] [--verbose]"
    flags: ["--list", "--dry-run", "--verbose", "--help"]
    
  code-review:
    description: "Fast code review gate: style check, history-aware review, obvious-bug scan"
    entry: "./tools/code_review_gate.zsh"
    fallback: "./tools/local_agent_review.py"
    usage: "zsh tools/run_tool.zsh code-review <target> [--quick] [--json]"
    flags: ["--staged", "--unstaged", "--diff", "--quick", "--json"]
    gate: "Gate 2.5 (after DRYRUN, before VERIFY)"
    output: "✅/⚠️ verdict with risks + diff hotspots"
    cache: "g/.cache/code_review_cache.json"
    notes: "Use run_tool.zsh wrapper. Fallback auto-discovery if not in catalog."
    
  run-tool:
    description: "Single entry point for all tools (wrapper)"
    entry: "./tools/run_tool.zsh"
    usage: "zsh tools/run_tool.zsh <tool-id> [args...]"
    notes: "Always use this wrapper. Auto-discovery fallback prevents blocking."

  gemini-bootstrap:
    description: "Gemini CLI profile bootstrap (banner + safe flags)"
    entry: "./tools/gemini_bootstrap.zsh"
    usage: "zsh tools/gemini_bootstrap.zsh <profile> [--print] [--doctor] [--] [gemini args...]"
    notes: "Reads profiles from ~/.config/gemini/policies.yaml and only passes gemini flags that exist in 'gemini --help'."

  gemini-full:
    description: "Gemini CLI full feature mode (OAuth + sandbox, human/full)"
    entry: "./tools/gemini_full_feature.zsh"
    usage: "zsh tools/gemini_full_feature.zsh [gemini args...]"
    env: "GEMINI_API_KEY unset (forces OAuth)"
    notes: "Unsets GEMINI_API_KEY to force OAuth flow. Uses --sandbox --approval-mode=default. Don't use --model auto (not valid in v0.21.1). Best default: don't send --model at all."

  gmx-system:
    description: "GMX system/plain mode (OAuth, no sandbox)"
    entry: "./tools/gmx_system.zsh"
    usage: "zsh tools/gmx_system.zsh [gemini args...]"
    env: "GEMINI_API_KEY unset (forces OAuth)"
    notes: "Unsets GEMINI_API_KEY to force OAuth flow. Uses --sandbox=false --approval-mode=default. For API key route (billable), create separate alias like gmx-api."
    
  git-restore-missing:
    description: "Safely restore files from origin/main that are missing locally"
    entry: "./tools/git_restore_missing_from_origin.zsh"
    usage: "zsh tools/git_restore_missing_from_origin.zsh [file1] [file2] ..."
    notes: "Checks for common missing files or restores specified files. Safe, non-destructive. Use when IDE shows 'deleted' files that exist in origin/main."
    
  git-safe-status:
    description: "Show git status with warnings for missing files from origin/main"
    entry: "./tools/git_safe_status.zsh"
    usage: "zsh tools/git_safe_status.zsh"
    notes: "Helps identify when IDE shows 'deleted' files that actually exist in origin/main. Shows branch status and missing file warnings."
    
  feature-dev-validate:
    description: "Mandatory validation gate for feature development"
    entry: "./tools/feature_dev_validate.zsh"
    usage: "zsh tools/run_tool.zsh feature-dev-validate <feature-slug>"
    gate: "Gate 4 (Production Readiness - MUST PASS before completion)"
    quality_gate: 90
    notes: "Runs all tests, calculates score, blocks completion if < 90%. MANDATORY before claiming completion."
    automation: "Can be run manually or via auto_workflow_executor.zsh"
    
  auto-workflow:
    description: "Fully automatic workflow executor (includes mandatory validation)"
    entry: "./tools/auto_workflow_executor.zsh"
    usage: "zsh tools/run_tool.zsh auto-workflow <feature-slug>"
    notes: "Runs full workflow automatically. Validation runs at end (Gate 4)."
    
  catalog-auto-update:
    description: "Scan tools/ directory and suggest catalog updates"
    entry: "./tools/catalog_auto_update.zsh"
    usage: "zsh tools/run_tool.zsh catalog-auto-update --scan"
    notes: "Catalog is curated manually (not auto-updated). Use --scan to see suggestions."
    update_frequency: "Manual (on-demand) or daily scan (suggestions only)"

# =============================================================================
# ALIASES — Shortcuts mapped to commands
# =============================================================================
aliases:
  save: "save-now"
  seal: "seal-now"
  drs: "seal-now"
  drs-status: "seal-status"
  qc: "git add -A && git commit -m 'quick save: $(date +%H:%M)'"
  git-checkout: "git-checkout-safe"
  git-clean: "git-clean-safe"
  git-uncommitted: "git status --porcelain"

# =============================================================================
# CORE TOOLS — Important scripts and their roles
# =============================================================================
core_tools:
  gateways:
    - name: "save.sh"
      role: "Gateway for session save"
      do_not_call_directly: false
      
    - name: "workflow_dev_review_save.zsh"
      role: "Seal chain orchestrator"
      do_not_call_directly: false
      
  backends:
    - name: "session_save.zsh"
      role: "Backend engine for save"
      do_not_call_directly: true
      note: "Use save.sh instead"
      
    - name: "local_agent_review.py"
      role: "Local agent review"
      do_not_call_directly: true
      
  utilities:
    - name: "spawn.zsh"
      role: "LAPP Plugin Spawner"
      
    - name: "catalog_lookup.zsh"
      role: "Query this catalog"
      
    - name: "mary_preflight.zsh"
      role: "Mary Router preflight check"
      
    - name: "hub_index_now.zsh"
      role: "Refresh hub index"

# =============================================================================
# AGENT RULES — How agents should use this catalog
# =============================================================================
agent_rules:
  - rule: "When asked about tools/commands/aliases, query this catalog first"
    command: "zsh tools/catalog_lookup.zsh <command>"
    
  - rule: "Never answer from memory alone for tool questions"
    
  - rule: "If catalog doesn't have the answer, search files then update catalog"
    
  - rule: "Use entry field as the correct command, not memory"
    
  - rule: "Code review is Gate 2.5 in auto workflow (after DRYRUN, before VERIFY)"
    command: "zsh tools/code_review_gate.zsh <target>"
    
  - rule: "All agents must use catalog_lookup.zsh before executing any tool/command"
    purpose: "Prevent outdated info, misunderstanding, system lag"
